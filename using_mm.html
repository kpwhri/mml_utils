<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Extracting Concepts Using MetaMap &#8212; Metamaplite Utilities 0.4.1 documentation</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css?v=a123c646" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script src="_static/documentation_options.js?v=bd778e0b"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js?v=dbd2e957"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using MetaMapLite" href="using_mml.html" />
    <link rel="prev" title="UMLS License" href="umls_license.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">Metamaplite Utilities 0.4.1 documentation</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent" role="heading">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="afep.html">
   Automated Feature Extraction for Phenotyping (AFEP)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="build_umls_for_ctakes.html">
   Build UMLS for cTAKES
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="build_umls_for_mml.html">
   Build UMLS for Metamaplite
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="install_ctakes.html">
   Installing cTAKES
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="install_metamaplite.html">
   Installing MetaMapLite
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="install_mm.html">
   Instructions for Installing Metamap on Windows
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="install_umls.html">
   Install UMLS Metathesaurus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   Troubleshooting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="umls_license.html">
   UMLS License
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Extracting Concepts Using MetaMap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="using_mml.html">
   Using MetaMapLite
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/using_mm.md.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup-prerequisites">
   Setup/Prerequisites
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#build-config-files-and-shell-scripts">
   Build Config Files and Shell Scripts
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#format-definition">
     Format/definition
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-config-toml">
     Example
     <code class="docutils literal notranslate">
      <span class="pre">
       config.toml
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-config-toml-to-build-scripts">
     Run
     <code class="docutils literal notranslate">
      <span class="pre">
       config.toml
      </span>
     </code>
     to Build Scripts
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-metamap">
   Running Metamap
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ensure-directories">
     Ensure Directories
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#start-servers">
     Start Servers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-metamap">
     Run Metamap
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extracting-cuis-from-metamap-output">
   Extracting CUIs from Metamap Output
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#parameters">
     Parameters
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-config">
     Example Config
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-afep">
   Run AFEP
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <section id="extracting-concepts-using-metamap">
<h1>Extracting Concepts Using MetaMap<a class="headerlink" href="#extracting-concepts-using-metamap" title="Link to this heading">¶</a></h1>
<p>Use case: I want to use MetaMap to extract concepts from the UMLS. This document will cover building configuration files to run <code class="docutils literal notranslate"><span class="pre">metamap</span></code>.</p>
<p>Since the focus of this documentation is on usage of the <code class="docutils literal notranslate"><span class="pre">mml_utils</span></code> package, it will be assumed that this is installed (but it is definitely not required). Note that in the case of Metamap, <code class="docutils literal notranslate"><span class="pre">mml_utils</span></code> <strong>cannot</strong> be the sole intermediary. Instead, it will generate shell scripts which must be run in a Linux (or WSL) environment.</p>
<section id="setup-prerequisites">
<h2>Setup/Prerequisites<a class="headerlink" href="#setup-prerequisites" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Installation is discussed <a class="reference internal" href="install_mm.html#install-metamap"><span class="std std-ref">elsewhere</span></a></p>
<ul>
<li><p>The install directory will be referred to as <code class="docutils literal notranslate"><span class="pre">$MM_HOME</span></code></p></li>
</ul>
</li>
<li><p>Installation of UMLS for MM is discussed <a class="reference internal" href="install_mm.html#download-datasets"><span class="std std-ref">elsewhere</span></a></p></li>
<li><p>Text files</p>
<ul>
<li><p>These <em>must</em> end in a newline, otherwise the final line will not be processed.</p></li>
</ul>
</li>
<li><p>Filelist</p>
<ul>
<li><p>Create a text file with the full path to each of the text files to be processed on a separate line. E.g., <code class="docutils literal notranslate"><span class="pre">C:\path\to\1.txt\nC:\path\to\2.txt\n[...]</span></code></p></li>
</ul>
</li>
</ul>
<blockquote>
<div><p><strong>Warning</strong><br />
<strong>Text files must have a newline at the end</strong>: This is a bit sparse in the Metamap documentation, but if a line does not end in a newline character (\n), that line will not be processed. Practically, this only applies to the last line.
To fix, you can always open the file and press <code class="docutils literal notranslate"><span class="pre">ENTER</span></code> at the end of the last line.
In Python, something like <code class="docutils literal notranslate"><span class="pre">outfile.write(infile.read()</span> <span class="pre">+</span> <span class="pre">'\n')</span></code> is sufficient.</p>
</div></blockquote>
</section>
<section id="build-config-files-and-shell-scripts">
<h2>Build Config Files and Shell Scripts<a class="headerlink" href="#build-config-files-and-shell-scripts" title="Link to this heading">¶</a></h2>
<p>To generate the shell scripts, create a configuration file in the TOML format called <code class="docutils literal notranslate"><span class="pre">config.toml</span></code>. This shell script can handle creating multiple sub-configurations if you want to run Metamap with different sets of parameters. Each of these sub-configurations is called a ‘run’.</p>
<blockquote>
<div><p><strong>Warning</strong>
<strong>Forbidden Characters in the File Paths</strong>: Metamap’s file parser will throw errors for certain file paths (e.g., a path with parenthesis like: <code class="docutils literal notranslate"><span class="pre">C:\projects\grant1</span> <span class="pre">(asthma)\corpus\file1.txt</span></code>). I’m not going to list all of the problematic tokens, but prefer using alphanumerics without spaces (use capitalization [CamelCase] or underscores [snake_case] to separate tokens).</p>
</div></blockquote>
<p>In providing an example configuration, I’m going to use Windows-based examples since these are more challenging to encode correctly (i.e., certain elements need to be Windows-formatted paths and others need to be Unix-styled paths). For other OSs, just use all <em>normal</em> (i.e., Unix-style) paths. For Windows, follow the examples below carefully.</p>
<section id="format-definition">
<h3>Format/definition<a class="headerlink" href="#format-definition" title="Link to this heading">¶</a></h3>
<p>For all <code class="docutils literal notranslate"><span class="pre">run</span></code>s, these are the global definitions.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="n">outpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;PATH for output scripts&#39;</span>
<span class="n">filelist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;PATH to corpus filelist&#39;</span>
<span class="n">mm_outpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;PATH for metamap to write files, use Unix-style path&#39;</span>
<span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CONFIGURATION parameters for all runs&#39;</span>
<span class="n">num_scripts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Number of scripts to run (this allows parallelization&#39;</span>
<span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;List of any replacements in the path to apply; useful for Windows -&gt; Unix conversions.&#39;</span>
<span class="n">mm_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;$MM_PATH&#39;</span>
</pre></div>
</div>
<p>For each <code class="docutils literal notranslate"><span class="pre">run</span></code>, a <code class="docutils literal notranslate"><span class="pre">[[runs]]</span></code> must be provided. All parameters supplied here with either <em>add</em> or <em>overwrite</em> the higher level components. E.g., <code class="docutils literal notranslate"><span class="pre">parameters</span></code> will <em>add</em> to the global set, whereas <code class="docutils literal notranslate"><span class="pre">outpath</span></code> with <em>overwrite</em>.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[runs]]</span>
<span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;(Required) Any parameters specific for this run, adds to the global set&#39;</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;(Required) Arbitrary (though hopefully useful) name&#39;</span>
<span class="n">mm_outpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;(Optional) overwrite `mm_outpath` from global level&#39;</span><span class="w"> </span>
</pre></div>
</div>
</section>
<section id="example-config-toml">
<h3>Example <code class="docutils literal notranslate"><span class="pre">config.toml</span></code><a class="headerlink" href="#example-config-toml" title="Link to this heading">¶</a></h3>
<p>The following <code class="docutils literal notranslate"><span class="pre">config.toml</span></code> will run the 2022AB UMLS corpus on the NLM subset using MDR (Meddra) and RXNORM.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="n">outpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;C:/project/extract/metamap/scripts&#39;</span>
<span class="n">filelist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;C:\project\corpora\corpus1\filelist_corpus1.txt&#39;</span>
<span class="n">mm_outpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/mnt/c/project/extract/metamap/mmout&#39;</span>
<span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;-Z 2022AB -V NLM -R MDR,RXNORM -N&#39;</span>
<span class="n">num_scripts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
<span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;C:&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/mnt/c&#39;</span><span class="p">]</span>
<span class="n">mm_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/mnt/c/public_mm&#39;</span>

<span class="k">[[runs]]</span>
<span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;rxnorm_mdr&#39;</span>

<span class="k">[[runs]]</span>
<span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;-y&#39;</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;rxnorm_mdr_y&#39;</span>

<span class="k">[[runs]]</span>
<span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;--negex&#39;</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;rxnorm_mdr_negation&#39;</span>
</pre></div>
</div>
</section>
<section id="run-config-toml-to-build-scripts">
<h3>Run <code class="docutils literal notranslate"><span class="pre">config.toml</span></code> to Build Scripts<a class="headerlink" href="#run-config-toml-to-build-scripts" title="Link to this heading">¶</a></h3>
<p>Once the <code class="docutils literal notranslate"><span class="pre">config.toml</span></code> is ready, building the scripts is as simple as running:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mml-build-mmscript-multi</span> <span class="pre">config.toml</span></code></p></li>
</ul>
<p>Please note that <code class="docutils literal notranslate"><span class="pre">mml_utils</span></code> must be installed to make this work (run <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">mml_utils;</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">.</span></code>)</p>
<p>This will create (when using the <a class="reference internal" href="#example-configtoml"><span class="xref myst">Example Config above</span></a>) an output file <code class="docutils literal notranslate"><span class="pre">scripts</span></code> with at least three different shell scripts which will be explained below.</p>
<p>In addition to these three scripts, a <code class="docutils literal notranslate"><span class="pre">run_afep_{date}.toml</span></code> config file will also be generated. This file will need editing, but can be passed to <code class="docutils literal notranslate"><span class="pre">mml-run-afep-multi</span></code> to run AFEP (Automated Feature Engineering for Phenotyping) on the extracted output. See <a class="reference internal" href="#run-afep"><span class="xref myst">below</span></a>.</p>
</section>
</section>
<section id="running-metamap">
<h2>Running Metamap<a class="headerlink" href="#running-metamap" title="Link to this heading">¶</a></h2>
<p>Here we will use the scripts generated by the <code class="docutils literal notranslate"><span class="pre">config.toml</span></code> run in the previous step. This will consist of three scripts (or, <em>types</em> of scripts) which should be run in the order below:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ensure_directories.sh</span></code></p>
<ul>
<li><p>Ensure that required output directories exist</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">start_servers.sh</span></code></p>
<ul>
<li><p>Start the WSD and POS taggers</p></li>
<li><p>May need to prefix these with <code class="docutils literal notranslate"><span class="pre">$MM_PATH</span></code> if <code class="docutils literal notranslate"><span class="pre">mm_path</span></code> was not included</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">script_N.sh</span></code></p>
<ul>
<li><p>Scripts that will actually run Metamap</p></li>
<li><p>These are divided into separate processes</p></li>
</ul>
</li>
</ul>
<p>With all scripts, it is worth at least taking a quick look at the files to make sure that reasonable defaults have been included.</p>
<p>Also, if you need to mount a particular drive (e.g., WSL on Windows), use <code class="docutils literal notranslate"><span class="pre">mount</span> <span class="pre">-t</span> <span class="pre">drvfs</span> <span class="pre">C:</span> <span class="pre">/mnt/c</span></code>.</p>
<section id="ensure-directories">
<h3>Ensure Directories<a class="headerlink" href="#ensure-directories" title="Link to this heading">¶</a></h3>
<p>This script makes sure the correct output directories actually exist.</p>
</section>
<section id="start-servers">
<h3>Start Servers<a class="headerlink" href="#start-servers" title="Link to this heading">¶</a></h3>
<p>This script will start the WSD and POS tagging servers. This only needs to be completed once on each server/computer this is being run on. Each of the <code class="docutils literal notranslate"><span class="pre">script_N.sh</span></code> shell scripts will need to communicate with these servers.</p>
</section>
<section id="run-metamap">
<h3>Run Metamap<a class="headerlink" href="#run-metamap" title="Link to this heading">¶</a></h3>
<p>These will run Metamap.</p>
<ul class="simple">
<li><p>If you just see <code class="docutils literal notranslate"><span class="pre">metamap</span></code>, ensure <code class="docutils literal notranslate"><span class="pre">$MMPATH/bin</span></code> is on the path</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">PATH=$PATH:/mnt/c/public_mm/bin</span></code></p></li>
</ul>
</li>
</ul>
<p>The format of this file will look like:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">metamap</span></code> or <code class="docutils literal notranslate"><span class="pre">$MM_PATH</span></code></p></li>
<li><p>The parameters</p></li>
<li><p>The input file (<code class="docutils literal notranslate"><span class="pre">*.txt</span></code>)</p></li>
<li><p>The output file (<code class="docutils literal notranslate"><span class="pre">*.mmi</span></code>)</p></li>
</ul>
<p>Run each script in a separate shell script (and ensure that <code class="docutils literal notranslate"><span class="pre">$MM_PATH/bin</span></code> is on the <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> in each shell).</p>
</section>
</section>
<section id="extracting-cuis-from-metamap-output">
<h2>Extracting CUIs from Metamap Output<a class="headerlink" href="#extracting-cuis-from-metamap-output" title="Link to this heading">¶</a></h2>
<p>Once all of the <code class="docutils literal notranslate"><span class="pre">script_N.sh</span></code> shell scripts have finished running (and it’s a good idea to glance at the last few to make sure there aren’t any devious errors), you’ll want to get the CUIs out of the output.</p>
<p>To accomplish this, we’ll run <code class="docutils literal notranslate"><span class="pre">mml-extract-mml</span></code> which will read all of the <code class="docutils literal notranslate"><span class="pre">*.mmi</span></code> files and extract all (or a specified subset of) CUIs. This will generate three output files.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mml.csv</span></code>: all extracted CUIs</p>
<ul>
<li><p>See an example in the repository’s <a class="reference external" href="https://github.com/kpwhri/mml_utils/blob/master/examples/complete/mmlout/mml.mmi.csv">example directory</a></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">notes.csv</span></code>: note-level information/counts about the notes in the corpus</p>
<ul>
<li><p>See an example in the repository’s <a class="reference external" href="https://github.com/kpwhri/mml_utils/blob/master/examples/complete/mmlout/notes.mmi.csv">example directory</a></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">cuis_by_doc.csv</span></code>: pivot table showing number of CUIs of each kind in a document</p>
<ul>
<li><p>Each row represents a single input document</p></li>
<li><p>The columns are CUIs</p></li>
<li><p>Each value represents the count of CUIs in a particular row</p></li>
<li><p>See an example in the repository’s <a class="reference external" href="https://github.com/kpwhri/mml_utils/blob/master/examples/complete/mmlout/cui_by_doc.mmi.csv">example directory</a></p></li>
</ul>
</li>
</ul>
<section id="parameters">
<h3>Parameters<a class="headerlink" href="#parameters" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CORPUS_DIR</span></code>: path to files in the corpus that was processed</p>
<ul>
<li><p>If more than one directory was used, supply them all as arguments</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">--outdir</span></code>: directory to write output to</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--output-format</span></code>: extension of the file (i.e., for Metamap, use <code class="docutils literal notranslate"><span class="pre">mmi</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--output-direcctory</span></code>: directory containing metamap’s output <code class="docutils literal notranslate"><span class="pre">*.mmi</span></code> files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--cui-file</span></code>: (optional) file of 1 CUI per line to be extracted (all others will be ignored)</p>
<ul>
<li><p>If you want CUIs to ‘normalized’ (where multiple CUIs might map to a single CUI), each row in the <code class="docutils literal notranslate"><span class="pre">cui_file</span></code> can contain two CUIs where the first, when identified, will be mapped to the second.</p>
<ul>
<li><p>In the following lines, all instances of <code class="docutils literal notranslate"><span class="pre">C0012344</span></code> and <code class="docutils literal notranslate"><span class="pre">C0012345</span></code> will be mapped to <code class="docutils literal notranslate"><span class="pre">C0012344</span></code>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">C0012344,C0012344</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C0012345,C0012344</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="example-config">
<h3>Example Config<a class="headerlink" href="#example-config" title="Link to this heading">¶</a></h3>
<p>Here’s an example run on the command line, using the data generated by <code class="docutils literal notranslate"><span class="pre">config.toml</span></code> (<a class="reference internal" href="#example-configtoml"><span class="xref myst">above</span></a>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mml</span><span class="o">-</span><span class="n">extract</span><span class="o">-</span><span class="n">mml</span>
<span class="n">C</span><span class="p">:</span>\<span class="n">project</span>\<span class="n">corpora</span>\<span class="n">corpus1</span>\<span class="n">files</span>
<span class="o">--</span><span class="n">outdir</span>
<span class="n">C</span><span class="p">:</span>\<span class="n">project</span>\<span class="n">extract</span>\<span class="n">cuis</span>
<span class="o">--</span><span class="n">cui</span><span class="o">-</span><span class="n">file</span>
<span class="n">C</span><span class="p">:</span>\<span class="n">project</span>\<span class="n">cuis</span><span class="o">.</span><span class="n">txt</span>
<span class="o">--</span><span class="n">output</span><span class="o">-</span><span class="nb">format</span>
<span class="n">mmi</span>
<span class="o">--</span><span class="n">output</span><span class="o">-</span><span class="n">directory</span>
<span class="n">C</span><span class="p">:</span>\<span class="n">project</span>\<span class="n">extract</span>\<span class="n">mmout</span>\<span class="n">rxnorm_mdr</span>
</pre></div>
</div>
<p>This will generate the <code class="docutils literal notranslate"><span class="pre">mmi.csv</span></code>, <code class="docutils literal notranslate"><span class="pre">notes.csv</span></code>, and <code class="docutils literal notranslate"><span class="pre">cuis_by_doc.csv</span></code> files described above. (If the <code class="docutils literal notranslate"><span class="pre">cuis_by_doc.csv</span></code> file is absent, ensure that <code class="docutils literal notranslate"><span class="pre">pandas</span></code> is installed.)</p>
</section>
</section>
<section id="run-afep">
<h2>Run AFEP<a class="headerlink" href="#run-afep" title="Link to this heading">¶</a></h2>
<p>If you are using Metamap to run the PheNorm algorithm (or another algorithm which also requires use of AFEP), then this section will guide you through the steps. When running AFEP, the goal is to select the set of features which occurs across multiple knowledge base source. If you are on this step, you have, presumably, already run Metamap on the text of these articles (and ensured that each article terminated in a newline).</p>
<p>To run AFEP, update the <code class="docutils literal notranslate"><span class="pre">run_afep-{datetime}.toml</span></code> file generated in the <a class="reference internal" href="#build-config-files-and-shell-scripts"><span class="xref myst">Build Config Files section above</span></a>. Running this will generate a series of CSV files with (as long as <code class="docutils literal notranslate"><span class="pre">build_summary</span></code> is set to <code class="docutils literal notranslate"><span class="pre">true</span></code>) a summarizing CSV file. You can use the <code class="docutils literal notranslate"><span class="pre">afep_summary.csv</span></code> (or <code class="docutils literal notranslate"><span class="pre">afep_summary.xlsx</span></code>) file to review and select a subset of CUIs for inclusion.</p>
<p>Once the set of CUIs has been identified, create a file called, e.g., <code class="docutils literal notranslate"><span class="pre">cuis.txt</span></code>, and place each CUI on a separate line. If you want to do CUI normalisation, place the <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">CUI</span></code> (i.e., the CUI that is to be found in corpus) on the left, a comma, and then the <code class="docutils literal notranslate"><span class="pre">target</span> <span class="pre">CUI</span></code> (i.e., the CUI being mapped to) on the right.</p>
<p>Now, start from the beginning of this document to run Metamap on the entire corpus of notes. Then, when running <code class="docutils literal notranslate"><span class="pre">mml-extract-mml</span></code>, supply the <code class="docutils literal notranslate"><span class="pre">cuis.txt</span></code> as the <code class="docutils literal notranslate"><span class="pre">--include-cuis</span></code> parameter. This will extract only those CUIs identified by the AFEP process.</p>
</section>
</section>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="umls_license.html" title="previous page">UMLS License</a>
    <a class='right-next' id="next-link" href="using_mml.html" title="next page">Using MetaMapLite</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By dcronkite <dcronkite@gmail.com><br/>
        
            &copy; Copyright 2023, KPWHRI.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>